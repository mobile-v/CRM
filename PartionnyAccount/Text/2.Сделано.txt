           === Справочники === 
1. Доделать Сотрудников: редактировани и создание нового
   В складе указать Кассу и привязывать Сотрудника к Складу.
   Если не привязан, то может менять склад.
   Так, же на форме Сотрудника добавить переключатель "Только интерфейс розницы"

2. Справоник "Контрагенты"
3. Мои Фирмы: 
   Просто вывести список Контрагентов, у которых тип "Моя фирма"

4. Добавить Комбо с скидками для Контра Кнопка "Clear Discount"
   Сделать как в ВТорговомОблаке с Триггерами! - !!!!!! не сделано !!!!!!
5. Премия, 
6. Категория товара
7. Характеристики

8. Товар: Поиск по ID, Артикулу или Наименованию

9. Сделать редактирование товара в документе (Вынести все функции за предел контроллера)

10. SysJourDisps - добавить в Приход
11. Убрать с "SysJourDisps" записи "DocDisc" и "TableName"
12. Удаление

13.1. Разобратся как работает БД ServiceMY при Приходе и Расходе
13.2. Отмена проведения - учесть перемещения, продажи, ...

14 Касса
    Данные пишутся в Кассу (датой проведения) только при проведении документа!
	При снятии проводки удаляем данные из Кассы.
	Обо всём сообщаем пользователю.
	Операции:
	 - Приход в кассу на основании проведения документа № ХХХ
	 - Расход из Кассы на основании отмены проведения документа № ХХХ
	Если не хватает денег в кассе, то выдаём сообщение
	+1000 //Проведение
	-1000 //Отмена проведения
	+1050 //Проведение

15. Банк
    - Добавить редактирование справочника
    - В Склад добавить ещё: Банк!
    - В Сотрудника добавить: Организацию (для Розницы)
    - В приходе при оплате учесть связку Склад-Банк

16. Убрать таблицу "RemMotions"
    Тригеры перенести в таблицы: "RemParties" и "RemPartyMinuses"

17. Учесть Организацию для остатков
    Добавить поле "DirContractorIDOrg" в таблицы:
    - RemParties
    - RemPartyMinuses
    - RemRemnants
    Переписать Триггеры

18. В талицу "ListObjects" добавить Типы объектов: Другие, Справочники, Документы


19.
Если к Сотруднику привязан склад, то:
1. Как-то в Настройках делать выборку этого склада
2. В Документах не давать выбирать другой склад
Если у Сотрудника есть доступ только в Розницу - делать переадресацию!


20. Сделать Кассу и Банк: 
   - Внести 
   - Изъять


21. Расход
	1) Форма редактирования доделать!!!
	   "RemPartyID" добавлять в "ТабЕдит" и в грид "Един".

	2) Скидка: в приходе не было скидки для Контра, она есть в расходе!


22. 2. Расход
	ФронтЕнд: 
	- Когда списываем партию - запретить списывать больше, чем есть остатков!!!
    - Когда выбираем партию товара ПРОВЕРЯТЬ Склад. Если не соответствует - вывести об этом сообщение и НЕ открытвать форму!
	БекЕнд
	- Проверяем списание с партии, в контроллере Расходной накладной, проверять СКЛАД!!!
	- А то может быть такая ситуация: В Расходной накладной выбрали сначала один склад, списали с партии на этом складе.А потом поменяли склад.
    - Проверяем списание с партии, в контроллере Расходной накладной, проверять Организацию!!!

23. В Триггерах (RemParties, RemPartyMinuses) для "RemRemnants" учесть организацию!!!

24. Расход
	Разработать SQL-запрос для сверки корректности остатков:
	- RemParties.Remnant = RemParties.Quantity - RemPartyMinuses.Quantity
	- RemParties.Remnant и RemRemnants.Quantity

25. Форма редактирования спецификации загружается только 1 раз!!!

26. Продажа ПФ
   - Организация:
      - Внести все поля Оргинизации в "ListObjectFieldNames"
      - И потом полученные ID-шники внести в "ListObjectFields"
   - Добавить остальные ПФ

27. Перемещение
    - 2-а склада: "Списать с" и "Оприходовать на"
	- создаются записи в таблицах: RemPartyMinuses и RemParties - только склады разные 
	- оставить контрагента и участь склады: "DirWarehouseIDDebit" и "DirWarehouseIDPurch"
	- Цены приходные, но форма как в Приходе с характеристиками, только нельзя их редактировать (цены приходные тоже нельзя)!

28. Товары
   Создать 2-ю вкладку
   Если переключена вторая вкладка или по нажатию на кнопку - выводить список партий товара по всем складам на выбор:
     1) Только с остатком
	 2) С остатком и без остатка
   Правой кнопкой выши выводить списания по каждой партии.

29. Перемещение: ПФ

30. Недоработка
    С партий можно списать больше, чем есть на остатке !!!
    Если списіваем с одной партии


31. Возврат поставщику (Просто списываем товар с партии, которая пришла от выбранного поставщика и есть на остатке)

   Алгоритм №1: - этот использовал
   Всё как в Продаже
   1. Товар слева, Склад, Поставщик, Фирма - выбираются вручную.
   2. Сверху появляются партии товара, которые пришли от выбранного поставщика
   3. Выбираем партию.
   4. Сохраняем или проводим - товар списывается.
   5. Товар списывается в "RemPartyMinuses" по приходным ценам.

   Алгоритм №2:
   Возврат формируется на основании Приходной накладной.
   Списка товаров слева - нет
   1. Указываем № приходной накладной
   2. Автоматически проставляются Фирма, Склад и Поставщик (это поля не readOnly)
   3. У нас появляются партии товара (сверху) указанного прихода
   4. Даём списать только то, что осталось на остатке
   5. Сохраняем или проводим - товар списывается.

32. Списание - как продажа, только нет учета прибыли и по приходным ценам.


33. Возврат от покупателя
1. Организация: если сотрудник привязан к организации, а расходный документ с другой организации
   Решение:
   Отображать все документы только те к которым привязан сотрудник
Удалить
	1. Клиент приносит номер документа "Продажа".
	2. Находится документ "Продажа" по этому номеру.
	3. Входим в документ и создаём "на основании" документ "Возврат от покупателя"
	4. При Проведении, товар возвращается на склад
	   Все параметры партии передаются из связки: Партия - ПартияМинус - Партия
BackEnd:
	1. Получить характеристики Партии с позиции "PartyMinusID"
	2. Спецификация + характеристики = полноценная партия
	3. Пишем в таблицу партии
	4. Появляется новая партия, а не дополняется партия (прихода)

   Проблема, что товар продаётся, а не приходуется. Соответственно данные о продаже находятся в таблице "RemPartyMinuses".
   Как организовать списание с таблицы "RemPartyMinuses".
   Идея №1:
     - выводить список не "Партий", а "Списанных партий" от выбранного контрагента - вот тут проблема т.к. спис.партий может быть много, поэтому просить дату покупки надо! И по дате выводить списанные партии.
	 - выбираем из них товар
	 - проверяем, что бы было не более чем есть на "остатке" (вернее "списаного") у клиента и на сервере.
	 - создаём партию
	 - но ... как связвать таблицы в "обратную" сторону??? 
	     - нужно ли связвать? тогда надо в Партиях вводить поле для "RemPartyMinuses.RemPartyMinusID" (с какого списания вернули товар) - это лучший вариант.
		 - или не нужно связвать?
   Идея №2:
     - Как в "Мой Склад".
	   По номеру Продажи выводим все списанные партии в "НОВОЙ" таблицы для "Списанных партий"!


34. Проверять дату документа и партии. Что бы не списать партию, котороай ещё нет (не оприходовали, переместили) по дате.

35. Акт выполненых работ - как в ВТорговомОблаке
    Форму редактирования сделать как в приходе, то есть без партий, просто выбираем товар
    Редактирование спецификации, как в расходе


36. Счет
    1. Будет "Резерв". При оплате или создании на основании рахода будет предупреждение, что документ на Резерве! Да и вообще при открытии документа предупреждать, что документ на резерве!
    2. Слева будет ТриВью: Все, На резерве, Оплачен, Частично оплачен, Не оплачен
    3. Оплата будет выставлятся галочкой
    4. Будет создаваться Расходная накладная "На Основании"
    5. ПФ
	6. Счет на резерве, надо снимать привязку, "RemParty = null"
	   При создании на основании, снимать с резерва на автомате!
	   Или предупреждать клиента, что Счет на резерве, снимите с резерва, а то не будет не хватать остатка партий!


37. Инвентаризация
    Реквизиты.
	- Шапка: 
	- Дата,
	- Организация,
	- Склад

	- Табличная часть:

	Можно как списывать с партий, так и приходовать товар
	- При списании указывается партия (как в расходе).
	  То есть есть партия и с неё списываем.
	- При оприходовании указываем только сам товар из Дерев слева (как в приходе)
	  То есть нет партии, оприходываем новую партию.

	Спецификация
	- Есть 2-а поля Quantity: QuantityDoc и QuantityReal
	- QuantityDoc - это к-во на остатке. Активное только при списании с партии, при оприходование не активное поле.
	- QuantityReal - реальное к-во. Всегда активное. Если 0, то оприходование не совершается.

	2. Табличная часть. Сверху расположены партии

	3. Процесс списания - Оприходования.
	   - Сохранение - резервирование товара
	   - Проведении - Списание и оприходование

	I. Есть только приход

	   1. Проверка не списали ли с прихода товар.

	   2. Списываем весь товар.
	   Берём каждую партию, смотрим поле "Remnant" (создаём запись в "RemPartyMinuses" на эту партию с Quantity = Remnant)
	   Или можно это сделать одним запросом:
		INSERt INTO RemPartyMinuses 
		(..., Quantity, ...)
		values
		SELECT ..., Remnant, ... FROM RemParties
		WHERE DirContractorIDOrg, Warehouse

	II. Есть и списание (сложнее ситуация)

	   1. Проверка не списали ли с прихода товар.

	   2. Надо пробегать каждую позицию в "RemParties"
		  Если она есть в Спецификации, то отнимаем к-во (создаём запись в "RemPartyMinuses" на эту партию с Quantity = Спецификация.Quantity)
		  Ну и проверить, не больше ли списываем!

	III. ПФ


39. Может быть так, что пользователь ввёл текст в КомбоБокс, которого нет в списке, тогда надо очистить Комбо!
    Сделать это для: Номенклатуры (стрндартной) и для всех характеристик!

      //Может быть так, что пользователь ввёл текст в КомбоБокс, которого нет в списке, тогда надо очистить Комбо!
      var combobox = Ext.getCmp("DirServiceNomenCategoryID" + aButton.UO_id);
      var v = combobox.getValue();
      var record = combobox.findRecord(combobox.valueField || combobox.displayField, v);
      var index = combobox.store.indexOf(record);
      if (index < 0) { combobox.setValue(null); }



=== === === Сервисный Центр === === ===

40. Таблицы в БД:
    Новые таблицы (Service, Services)

1. Справочник "Товар"
   Своя номенклатура для ремонта аппаратов
   Создать новую таблицу в БД
   DirServiceNomens

2. Справочник Клиенты
   DirServiceContractors (Имя, Алрес, Тел, ЕМейл)

3. Документ "Приемка"
   Содержит одиночные записи принятых товаров на ремонт
   DocServicePurches
   Поля:
   0. DocID - связь с документом Docs
   1. Серийный номер (SerialNumber TEXT(256))
   2. Вид ремонта: Не гарантийный, гарантийный (TypeRepair INTEGER)
   3. Комплектация (Components)
      3.1. Аппарат (ComponentDevice BOOL)
      3.2. Аккумулятор (ComponentBattery BOOL)
           Серийник (ComponentBatterySerial TEXT(256))
      3.3. Задняя крышка (ComponentBackCover BOOL)
      3.4. Пароль на устройстве (ComponentPass BOOL)
           Поле для ввода пароля (ComponentPasText TEXT(256))
      3.5. Другое 
           Поле для ввода текста (ComponentOtherText TEXT(256))
   4. Неисправность со слов клиента (большое поле для ввода) (ProblemClientWords)
   5. (Не используется) Типовые неисправности (комбобокс) (TypicalProblem)
   6. Примечание (Note)

   7. Клиент (Client)

      Поле для ввода (DirServiceContractorName TEXT(256))
      Галочка для: (DirServiceContractorRegular BOOL)
      Комбобокс с выбором постоянного клиента (DirServiceContractorID INTEGER)
      
      Адрес (из справочника, если постоянный) (DirServiceContractorAddress)
      Телефон (из справочника, если постоянный) (DirServiceContractorPhone)
      Мейл (из справочника, если постоянный) (DirServiceContractorEmail)

   8. Ориентир.стоимость (PriceVAT, PriceCurrency, DirCurrencyID, DirCurrencyRate, DirCurrencyMultiplicity)
   9. Дата готовности (DateDone)

   10. Срочный ремонт (UrgentRepairs BOOL)
   11. Предоплата (Prepayment BOOL)
       Поле для ввода суммы (PrepaymentSum)


41. Приёмка:
	1. Список всех Приёмок + их статус в виде изображения (8 статусто = 8 изображений)
	   Справа есть Фильтр по статусам:
		- Все (в списке отображается 7 статусов, то есть все кроме последнего)
		- 1 статус
		- 2 статус
		- ...
		- 8 статус
	2. Новая - открывается форма приёма на ремонт как в "ServiceMY"
	3. Редактирование - открывается форма приёма на ремонт как в "ServiceMY", НО !!!
	   только если статус №1, который присваивается автоматически
	   если статус больше 1, то выдавать сообщение, что для устройства сменили статус и его надо искать в "Мастерской"


	4. ПФ для только чир срзданного Акта
	5. И ШКИ для только что созданного Акта


42. Мастерская Редактирование
	Новый справочник "Выполненная работа".

	Шапка:
	 Менять можно
	  1. Сам список статусов в виде комбобокса
	  2. Гарантия в месяцах (текстовое поле, INTEGER)
	 Менять нельзя
	  3. Клиент (ФИО, Адрес, Телефон, ЕМейл)
	  4. Примечание
	  5. Кто принял
	  6. Комментарий инженера (в Доксах хранится)

	Табличные части:
	 Выполненная работа
	  1. Выбор из спраочника (справочник слева - это новый справочник)
	 Запчасти
	  2. Выбор из спраочника (справочник слева - это DirNomens)

	Низ:
	 Сумма работы
	 Сумма запчастей
	 Итого
	 Предоплата
	 Итого разница

	Кнопки
	 Сохранить


43. ПФ:
	1. Табличную часть сделать как UNION двух табличных частей в Таб1
	2. ПФ 2-аевида:
	   - для Приёмки аппарата
	   - для выдачи аппарата


44. Отчет "Прибыль"

45. Отчет "Прайс-Лист"

46.  Отчеты

47.Сервис - Отчет

48. Исправления и Доделать:
    - Права
	- Пробежатся по всем Объектам - UPDATE и исправить поле "sysJourDisp.ListObjectID" Дисп. журнала

49. Верхнее меню: Логин@Фирма

50. Инвентаризация: Сделать "по датам": запретить сохранять, проводить и снимать проводки до даты последней Инвентаризации

51. Добавить "Мастера" в Сервисном центре. В Контроллере изменить код!!!

52. Глючат Возвраты от покупателя:
    - В возвратах покупателя использовать только проведённые документы!
    - Не давать снимать проводку с документа, если документ использован в возврате от покупателя!
    - При проведении документа проверять - использован ли он в возврате от покупателя, если "ДА", то не давать проводить:
      Существует возврат от покупателя по данному документу! Проведение невозможно!
      Решение: удалите документ Возврат от покупателя, перед проведением данного документа!